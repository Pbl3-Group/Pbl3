@model HeThongTimViec.ViewModels.BaoCao.DanhSachBaoCaoViewModel

@{
    // Ép kiểu an toàn SelectList từ ViewBag
    var trangThaiOptions = ViewBag.TrangThaiXuLyOptions as SelectList;
}

<form asp-action="Index" asp-controller="BaoCao" method="get" class="filter-form-report">
    <div class="row g-3 align-items-end">
        
        <!-- Cột Từ khóa -->
        <div class="col-md-5">
            <label asp-for="tuKhoa" class="form-label small fw-medium"></label>
            @Html.TextBoxFor(m => m.tuKhoa, new { @class = "form-control form-control-sm", placeholder = "Tiêu đề, tên công ty, lý do..." })
            @Html.ValidationMessageFor(m => m.tuKhoa, "", new { @class = "text-danger small" })
        </div>

        <!-- Cột Trạng thái -->
        <div class="col-md-3">
            <label asp-for="trangThai" class="form-label small fw-medium"></label>
            @Html.DropDownListFor(m => m.trangThai,
                                 trangThaiOptions, // Sử dụng biến đã được ép kiểu
                                 new { @class = "form-select form-select-sm" })
        </div>

        <!-- Cột PageSize (Bổ sung mới) -->
        <div class="col-md-2">
            <label asp-for="pageSize" class="form-label small fw-medium"></label>
            @* Lấy các tùy chọn pageSize từ Model.PageSizeOptions đã được tạo trong Controller *@
            @Html.DropDownListFor(m => m.pageSize, 
                                 Model.PageSizeOptions, 
                                 new { @class = "form-select form-select-sm" })
        </div>
        
        <!-- Cột Buttons (Điều chỉnh lại cột và logic) -->
        <div class="col-md-2 d-grid gap-2 d-md-flex justify-content-md-end">
            <button type="submit" class="btn btn-primary btn-sm flex-grow-1 flex-md-grow-0">
                <i class="fas fa-filter me-1"></i> Lọc
            </button>
            
            @* Nút Xóa chỉ hiển thị khi có bộ lọc được áp dụng *@
            @if (!string.IsNullOrWhiteSpace(Model.tuKhoa) || Model.trangThai.HasValue)
            {
                // Logic mới: Tạo route values chỉ chứa pageSize để khi reset, lựa chọn này được giữ lại
                var resetFilterRouteValues = new Dictionary<string, string?>();
                
                // Chỉ thêm pageSize vào route nếu nó khác giá trị mặc định (ví dụ: 10) để giữ URL gọn gàng
                if (Model.pageSize != 5) 
                {
                    resetFilterRouteValues["pageSize"] = Model.pageSize.ToString();
                }

                <a asp-action="Index" 
                   asp-controller="BaoCao" 
                   asp-all-route-data="resetFilterRouteValues" 
                   class="btn btn-outline-secondary btn-sm"
                   title="Xóa bộ lọc tìm kiếm">
                    <i class="fas fa-times"></i>
                </a>
            }
        </div>
    </div>
</form>